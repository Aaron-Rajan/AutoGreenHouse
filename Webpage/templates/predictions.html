<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Latest AI Prediction</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-6">
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="w-full max-w-3xl mt-4">
      {% for category, message in messages %}
        <div class="bg-green-100 text-green-800 px-6 py-4 rounded-lg shadow-md text-center font-semibold">
            {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}


    <!-- Header Section -->
    <div class="w-full max-w-4xl bg-white p-6 rounded-lg shadow-md text-center">
        <h1 class="text-3xl font-bold text-gray-800">ğŸ§  Latest AI Prediction</h1>
        <p class="text-gray-600 mt-2">View the most recent prediction generated by the AI system based on sensor inputs.</p>
    </div>

    <!-- Back to Dashboard Button -->
    <a href="/" 
        class="mt-4 inline-block bg-blue-600 text-white text-lg font-semibold py-3 px-8 rounded-lg 
               hover:bg-blue-700 transition duration-300 shadow-md">
        â¬… Back to Dashboard
    </a>

    {% if prediction %}
    <!-- Predicted Sensor Values Section -->
    <div class="w-full max-w-4xl bg-white p-6 rounded-lg shadow-md mt-6">
        <h2 class="text-2xl font-bold text-gray-800 text-center">ğŸ”® Predicted Sensor Values</h2>
        <p class="text-gray-600 text-center mb-6">Predicted values for the next hour.</p>


        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-gray-50 p-4 rounded-lg shadow-md">
                <h3 class="text-xl font-semibold text-gray-700">â˜ CO2</h3>
                <p class="text-gray-600 mt-1">ğŸ”® Predicted: <span class="font-bold">{{ prediction.co2 }} ppm</span></p>
            </div>

            <div class="bg-gray-50 p-4 rounded-lg shadow-md">
                <h3 class="text-xl font-semibold text-gray-700">ğŸ›¢ TVOC</h3>
                <p class="text-gray-600 mt-1">ğŸ”® Predicted: <span class="font-bold">{{ prediction.tvoc }} ppb</span></p>
            </div>

            <div class="bg-gray-50 p-4 rounded-lg shadow-md">
                <h3 class="text-xl font-semibold text-gray-700">ğŸŒŠ Moisture</h3>
                <p class="text-gray-600 mt-1">ğŸ”® Predicted: <span class="font-bold">{{ prediction.moisture }}%</span></p>
            </div>

            <div class="bg-gray-50 p-4 rounded-lg shadow-md">
                <h3 class="text-xl font-semibold text-gray-700">ğŸŒ¡ Temperature</h3>
                <p class="text-gray-600 mt-1">ğŸ”® Predicted: <span class="font-bold">{{ prediction.temperature }}Â°C</span></p>
            </div>

            <div class="bg-gray-50 p-4 rounded-lg shadow-md">
                <h3 class="text-xl font-semibold text-gray-700">ğŸ’¦ Humidity</h3>
                <p class="text-gray-600 mt-1">ğŸ”® Predicted: <span class="font-bold">{{ prediction.humidity }}%</span></p>
            </div>

            <div class="bg-gray-50 p-4 rounded-lg shadow-md">
                <h3 class="text-xl font-semibold text-gray-700">âš— pH Level</h3>
                <p class="text-gray-600 mt-1">ğŸ”® Predicted: <span class="font-bold">{{ prediction.pH }}</span></p>
            </div>
        </div>

        <div class="text-center mt-4 text-gray-500">
            <p>ğŸ•’ Prediction Timestamp: <strong>{{ prediction.timestamp }}</strong></p>
        </div>
    </div>
    {% else %}
    <p class="text-center text-gray-600 mt-6">âš  No prediction data found.</p>
    {% endif %}

    <!-- Actuator Threshold + Suggested AI Thresholds -->
    <div class="w-full max-w-6xl bg-white p-6 rounded-lg shadow-md mt-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">âš™ï¸ Set Thresholds for Actuator Control</h2>
        <p class="text-gray-600 text-center mb-6">Configure target values for actuators or review AI-suggested thresholds below.</p>

        <div class="flex flex-col md:flex-row gap-6">
            <!-- Threshold Input Form -->
            <form action="/set_thresholds" method="POST" class="flex-1">
                <div class="grid grid-cols-1 gap-4">
                    <div>
                        <label for="moisture" class="block text-gray-700 font-medium mb-1">ğŸŒŠ Target Moisture (%)</label>
                        <input type="number" id="moisture" name="moisture"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400"
                            placeholder="e.g. 50">
                    </div>

                    <div>
                        <label for="temperature" class="block text-gray-700 font-medium mb-1">ğŸŒ¡ Target Temperature (Â°C)</label>
                        <input type="number" id="temperature" name="temperature"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400"
                            placeholder="e.g. 25">
                    </div>

                    <div>
                        <label for="ph" class="block text-gray-700 font-medium mb-1">âš— Target pH Level</label>
                        <input type="number" step="0.01" id="ph" name="ph"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400"
                            placeholder="e.g. 6.5">
                    </div>

                    <div>
                        <label for="co2" class="block text-gray-700 font-medium mb-1">â˜ Target CO2 (ppm)</label>
                        <input type="number" id="co2" name="co2"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400"
                            placeholder="e.g. 700">
                    </div>

                    <div>
                        <label for="tvoc" class="block text-gray-700 font-medium mb-1">ğŸ›¢ Target TVOC (ppb)</label>
                        <input type="number" id="tvoc" name="tvoc"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400"
                            placeholder="e.g. 40">
                    </div>

                    <div>
                        <label for="humidity" class="block text-gray-700 font-medium mb-1">ğŸ’¦ Target Humidity (%)</label>
                        <input type="number" id="humidity" name="humidity"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400"
                            placeholder="e.g. 65">
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="text-center mt-6">
                    <button type="submit"
                    class="bg-green-600 text-white text-lg font-semibold py-3 px-8 rounded-lg 
                        hover:bg-green-700 transition duration-300 shadow-md">
                    âœ… Set Thresholds
                </button>
                </div>
            </form>

            <!-- Suggested AI Thresholds (Display Only) -->
            <div class="flex-1 bg-gray-50 p-6 rounded-lg shadow-inner">

                <!-- ESP32 Set Thresholds (Display Only) -->
                <div class="flex-1 bg-gray-50 p-6 rounded-lg shadow-inner mb-6">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4 text-center">ğŸ“Ÿ ESP32 Current Thresholds</h3>
                    {% if thresholds %}
                    <ul class="space-y-3 text-gray-700">
                        <li>ğŸŒŠ Moisture: <span class="font-bold text-green-600">{{ thresholds.moisture }}%</span></li>
                        <li>ğŸŒ¡ Temperature: <span class="font-bold text-green-600">{{ thresholds.temperature }}Â°C</span></li>
                        <li>âš— pH Level: <span class="font-bold text-green-600">{{ thresholds.pH }}</span></li>
                        <li>ğŸ’¦ Humidity: <span class="font-bold text-green-600">{{ thresholds.humidity }}%</span></li>
                        <li>ğŸ›¢ TVOC: <span class="font-bold text-green-600">{{ thresholds.tvoc }} ppb</span></li>
                        <li>â˜ CO2: <span class="font-bold text-green-600">{{ thresholds.co2 }} ppm</span></li>
                    </ul>
                    <p class="text-sm text-gray-500 text-center mt-4">*These are the most recently configured thresholds sent to the ESP32.</p>
                    {% else %}
                    <p class="text-center text-gray-600">âš  No threshold values configured yet.</p>
                    {% endif %}
                </div>


                <h3 class="text-xl font-semibold text-gray-700 mb-4 text-center">ğŸ’¡ Suggested AI Thresholds</h3>
                {% if optimal %}
                <ul class="space-y-3 text-gray-700">
                    <li>ğŸŒŠ Moisture: <span class="font-bold text-blue-600">{{ optimal.moisture }}%</span></li>
                    <li>ğŸŒ¡ Temperature: <span class="font-bold text-blue-600">{{ optimal.temperature }}Â°C</span></li>
                    <li>âš— pH Level: <span class="font-bold text-blue-600">{{ optimal.pH }}</span></li>
                    <li>ğŸ’¦ Humidity: <span class="font-bold text-blue-600">{{ optimal.humidity }}%</span></li>
                    <li>ğŸ›¢ TVOC: <span class="font-bold text-blue-600">{{ optimal.tvoc }} ppb</span></li>
                    <li>â˜ CO2: <span class="font-bold text-blue-600">{{ optimal.co2 }} ppm</span></li>
                </ul>
                <p class="text-sm text-gray-500 text-center mt-4">*AI-generated values based on environmental conditions.</p>
                {% else %}
                <p class="text-center text-gray-600">âš  No AI thresholds available.</p>
                {% endif %}
            </div>
        </div>
    </div>
